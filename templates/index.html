<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFXIV Battle Tracker</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <header>
        <h1>FFXIV Battle Tracker</h1>
        <div id="session-info">
            <select id="fight-selector">
                <option value="">Loading...</option>
            </select>
        </div>
        <div id="header-actions">
            <button id="refresh-btn" class="header-btn" title="Refresh data (Ctrl+R)">Refresh</button>
        </div>
    </header>

    <main>
        <aside id="sidebar">
            <section id="summary-section">
                <h2>Session Summary</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value" id="total-fights">0</span>
                        <span class="stat-label">Fights</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="total-attempts">0</span>
                        <span class="stat-label">Attempts</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="total-wipes">0</span>
                        <span class="stat-label">Wipes</span>
                    </div>
                </div>
                <div id="extended-stats">
                    <div class="stat-row">
                        <span class="stat-name">Total Deaths</span>
                        <span class="stat-value-inline" id="total-deaths">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-name">Avg Attempt Duration</span>
                        <span class="stat-value-inline" id="avg-duration">0s</span>
                    </div>
                </div>
            </section>

            <section id="fights-section">
                <h2>Fights</h2>
                <div id="fights-list"></div>
            </section>
        </aside>

        <section id="content">
            <div id="attempt-header">
                <h2>Select an attempt</h2>
                <div id="attempt-meta"></div>
            </div>

            <div id="tabs">
                <div class="tabs-left">
                    <button class="tab-btn active" data-tab="abilities" title="Press 1">Ability Hits</button>
                    <button class="tab-btn" data-tab="debuffs" title="Press 2">Debuffs</button>
                    <button class="tab-btn" data-tab="targeting" title="Press 3">Targeting</button>
                    <button class="tab-btn" data-tab="deaths" title="Press 4">Deaths</button>
                    <button class="tab-btn" data-tab="timeline" title="Press 5">Timeline</button>
                    <button class="tab-btn" data-tab="breakdown" title="Press 6">Breakdown</button>
                    <button class="tab-btn" data-tab="debuff-breakdown" title="Press 7">Debuff Breakdown</button>
                    <button class="tab-btn" data-tab="targeting-breakdown" title="Press 8">Target Breakdown</button>
                </div>
                <div class="tabs-right">
                    <label class="checkbox-label">
                        <input type="checkbox" id="show-unknown-filter">
                        <span>Show Unknown</span>
                    </label>
                </div>
            </div>

            <div id="tab-content">
                <div id="abilities-tab" class="tab-panel active">
                    <div class="tab-filter-bar">
                        <div class="filter-group">
                            <label for="abilities-player-filter">Player:</label>
                            <select id="abilities-player-filter">
                                <option value="">All Players</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="abilities-ability-filter">Ability:</label>
                            <select id="abilities-ability-filter">
                                <option value="">All Abilities</option>
                            </select>
                        </div>
                        <button class="filter-btn clear-tab-filter" data-tab="abilities" title="Clear filters">Clear</button>
                        <button id="manual-hit-type-btn" class="filter-btn" title="Manually set hit types for abilities">Manual Hit Types</button>
                    </div>
                    <table id="abilities-table">
                        <thead>
                            <tr>
                                <th class="sortable" data-sort="time">Time</th>
                                <th class="sortable" data-sort="ability">Ability</th>
                                <th class="sortable" data-sort="target">Target</th>
                                <th class="sortable" data-sort="damage">Damage Taken (Absorbed)</th>
                                <th class="sortable" data-sort="unmitigated">Unmitigated</th>
                                <th>Hit Type</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div id="debuffs-tab" class="tab-panel">
                    <div class="tab-filter-bar">
                        <div class="filter-group">
                            <label for="debuffs-player-filter">Player:</label>
                            <select id="debuffs-player-filter">
                                <option value="">All Players</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="debuffs-debuff-filter">Debuff:</label>
                            <select id="debuffs-debuff-filter">
                                <option value="">All Debuffs</option>
                            </select>
                        </div>
                        <button class="filter-btn clear-tab-filter" data-tab="debuffs" title="Clear filters">Clear</button>
                    </div>
                    <table id="debuffs-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Debuff</th>
                                <th>Target</th>
                                <th>Duration</th>
                                <th>Stacks</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div id="targeting-tab" class="tab-panel">
                    <div class="tab-filter-bar">
                        <div class="filter-group">
                            <label for="targeting-player-filter">Player:</label>
                            <select id="targeting-player-filter">
                                <option value="">All Players</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="targeting-event-filter">Event:</label>
                            <select id="targeting-event-filter">
                                <option value="">All Events</option>
                            </select>
                        </div>
                        <button class="filter-btn clear-tab-filter" data-tab="targeting" title="Clear filters">Clear</button>
                    </div>
                    <table id="targeting-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Event</th>
                                <th>Target</th>
                                <th>Source</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div id="deaths-tab" class="tab-panel">
                    <div class="tab-filter-bar">
                        <div class="filter-group">
                            <label for="deaths-player-filter">Player:</label>
                            <select id="deaths-player-filter">
                                <option value="">All Players</option>
                            </select>
                        </div>
                        <button class="filter-btn clear-tab-filter" data-tab="deaths" title="Clear filters">Clear</button>
                    </div>
                    <table id="deaths-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Player</th>
                                <th>Killed By</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div id="timeline-tab" class="tab-panel">
                    <div class="tab-filter-bar">
                        <div class="filter-group">
                            <label for="timeline-event-type-filter">Event Type:</label>
                            <select id="timeline-event-type-filter">
                                <option value="">All Events</option>
                                <option value="ability">Abilities</option>
                                <option value="debuff">Debuffs</option>
                                <option value="targeting">Targeting</option>
                                <option value="death">Deaths</option>
                            </select>
                        </div>
                        <label class="checkbox-label">
                            <input type="checkbox" id="timeline-simplified-toggle">
                            <span>Simplified View</span>
                        </label>
                        <button id="guess-timeline-btn" class="filter-btn guess-timeline-btn" title="Generate best guess timeline from all attempts">Guess Timeline From All Pulls (Experimental!! Jeff needs to work on this...)</button>
                        <button class="filter-btn clear-tab-filter" data-tab="timeline" title="Clear filters">Clear</button>
                    </div>
                    <div id="timeline-container">
                        <div id="timeline-header">
                            <span>Fight Timeline</span>
                            <span id="timeline-duration"></span>
                        </div>
                        <div id="timeline-content"></div>
                    </div>
                    <div id="simplified-timeline-container" style="display: none;">
                        <div id="simplified-timeline-header">
                            <span>Simplified Timeline</span>
                            <span id="simplified-timeline-duration"></span>
                        </div>
                        <div id="simplified-timeline-content"></div>
                    </div>
                    <div id="best-guess-timeline-container" style="display: none;">
                        <div id="best-guess-timeline-header">
                            <span>Best Guess Timeline</span>
                            <span id="best-guess-attempt-count"></span>
                        </div>
                        <div id="best-guess-timeline-content"></div>
                    </div>
                </div>

                <div id="breakdown-tab" class="tab-panel">
                    <div id="breakdown-container">
                        <div id="breakdown-filter-bar" class="breakdown-filter-bar">
                            <label for="breakdown-ability-filter">Ability:</label>
                            <select id="breakdown-ability-filter">
                                <option value="">Select an ability...</option>
                            </select>
                        </div>
                        <div id="breakdown-prompt" class="empty-state">
                            <p>Select a specific ability from the dropdown above to see breakdown across attempts</p>
                        </div>
                        <div id="breakdown-content" style="display: none;">
                            <div id="breakdown-header">
                                <span>Ability: </span>
                                <span id="breakdown-ability-name"></span>
                            </div>
                            <table id="breakdown-table">
                                <thead></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="debuff-breakdown-tab" class="tab-panel">
                    <div id="debuff-breakdown-container">
                        <div id="debuff-breakdown-filter-bar" class="breakdown-filter-bar">
                            <label for="breakdown-debuff-filter">Debuff:</label>
                            <select id="breakdown-debuff-filter">
                                <option value="">Select a debuff...</option>
                            </select>
                        </div>
                        <div id="debuff-breakdown-prompt" class="empty-state">
                            <p>Select a specific debuff from the dropdown above to see breakdown across attempts</p>
                        </div>
                        <div id="debuff-breakdown-content" style="display: none;">
                            <div id="debuff-breakdown-header">
                                <span>Debuff: </span>
                                <span id="debuff-breakdown-name"></span>
                            </div>
                            <table id="debuff-breakdown-table">
                                <thead></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="targeting-breakdown-tab" class="tab-panel">
                    <div id="targeting-breakdown-container">
                        <div id="targeting-breakdown-filter-bar" class="breakdown-filter-bar">
                            <label for="breakdown-targeting-filter">Targeting Event:</label>
                            <select id="breakdown-targeting-filter">
                                <option value="">Select a targeting event...</option>
                            </select>
                        </div>
                        <div id="targeting-breakdown-prompt" class="empty-state">
                            <p>Select a specific targeting event from the dropdown above to see breakdown across attempts</p>
                        </div>
                        <div id="targeting-breakdown-content" style="display: none;">
                            <div id="targeting-breakdown-header">
                                <span>Targeting: </span>
                                <span id="targeting-breakdown-name"></span>
                            </div>
                            <table id="targeting-breakdown-table">
                                <thead></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>FFXIV Battle Tracker - Parsing ACT logs for raid analysis</p>
        <p class="shortcuts-hint">Shortcuts: 1-8 Tabs | Ctrl+R Refresh | Esc Clear</p>
    </footer>

    <!-- Manual Hit Type Entry Modal -->
    <div id="hit-type-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Manual Hit Type Entry</h3>
                <button class="modal-close" id="hit-type-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-description">Set hit types for abilities. These will be remembered for the current session and applied to all attempts.</p>
                <div id="hit-type-table-container">
                    <table id="hit-type-table">
                        <thead>
                            <tr>
                                <th>Ability</th>
                                <th>Hit Type</th>
                            </tr>
                        </thead>
                        <tbody id="hit-type-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button id="hit-type-cancel-btn" class="modal-btn secondary">Cancel</button>
                <button id="hit-type-confirm-btn" class="modal-btn primary">Confirm</button>
            </div>
        </div>
    </div>

    <script src="/static/js/dashboard.js"></script>
</body>
</html>
